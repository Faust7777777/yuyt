<wxs module="tools">
  // хИдцЦнцЧ╢цо╡чК╢цАБ
  var getSlotStatus = function(confirmedSlots, pendingSlots, deletingSlots, day, slot) {
    // цгАцЯецШпхРжхЬих╛ЕхИащЩдхИЧшби
    for (var i = 0; i < deletingSlots.length; i++) {
      if (deletingSlots[i].day === day && deletingSlots[i].slot === slot) {
        return 'deleting';
      }
    }
    
    // цгАцЯецШпхРжхЬих╖▓чбошодхИЧшби
    for (var i = 0; i < confirmedSlots.length; i++) {
      if (confirmedSlots[i].day === day && confirmedSlots[i].slot === slot) {
        return 'confirmed';
      }
    }
    
    // цгАцЯецШпхРжхЬих╛ЕчбошодхИЧшби
    for (var i = 0; i < pendingSlots.length; i++) {
      if (pendingSlots[i].day === day && pendingSlots[i].slot === slot) {
        return 'pending';
      }
    }
    
    return '';
  };

  module.exports = {
    getSlotStatus: getSlotStatus
  };
</wxs>

<view class="container">
  <view class="header">
    <text class="title">шо╛ч╜оцЬмхСичй║щЧ▓цЧ╢щЧ┤</text>
    <text class="subtitle">ЁЯЯб щ╗ДшЙ▓=х╛Ечбошод ЁЯЯв ч╗┐шЙ▓=х╖▓шо╛ч╜о ЁЯФ┤ чБ░шЙ▓=х╛ЕхИащЩд</text>
  </view>

  <scroll-view scroll-x class="schedule-wrapper">
    <view class="schedule">
      <view class="row header-row">
        <view class="cell time-header">цЧ╢щЧ┤</view>
        <view 
          class="cell day-header" 
          wx:for="{{weekDays}}" 
          wx:key="index">
          {{item}}
        </view>
      </view>

      <view 
        class="row" 
        wx:for="{{timeSlots}}" 
        wx:key="index"
        wx:for-item="time"
        wx:for-index="slotIndex">
        
        <view class="cell time-cell">{{time}}</view>
        
        <view 
          class="cell slot-cell {{tools.getSlotStatus(confirmedSlots, pendingSlots, deletingSlots, dayIndex, slotIndex)}}"
          wx:for="{{weekDays}}" 
          wx:key="index"
          wx:for-index="dayIndex"
          bindtap="toggleSlot"
          data-day="{{dayIndex}}"
          data-slot="{{slotIndex}}">
          
          <text wx:if="{{tools.getSlotStatus(confirmedSlots, pendingSlots, deletingSlots, dayIndex, slotIndex) === 'confirmed'}}">тЬУ</text>
          <text wx:elif="{{tools.getSlotStatus(confirmedSlots, pendingSlots, deletingSlots, dayIndex, slotIndex) === 'pending'}}">?</text>
          <text wx:elif="{{tools.getSlotStatus(confirmedSlots, pendingSlots, deletingSlots, dayIndex, slotIndex) === 'deleting'}}">тЬЧ</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <view class="footer">
    <button class="confirm-add-btn" bindtap="confirmAdd">
      тЬЕ чбошодшо╛ч╜о ({{pendingSlots.length}})
    </button>
    
    <button class="confirm-delete-btn" bindtap="confirmDelete">
      ЁЯЧСя╕П чбошодхИащЩд ({{deletingSlots.length}})
    </button>
    
    <button class="view-appointments-btn" bindtap="viewAppointments">
      ЁЯУЛ цЯечЬЛщвДч║жшо░х╜Х
    </button>
  </view>
</view>
